var global=window;(function(e,t){typeof exports=="object"?(module.exports=t(global),module.exports.WebGLTFLoader=module.exports):typeof define=="function"&&define.amd?define([],function(){return t(e)}):t(e)})(this,function(e){"use strict";var t=["buffers","shaders","techniques","materials","meshes","cameras","lights","nodes","scenes"],n={buffer:"buffers",shader:"shaders",technique:"techniques",material:"materials",mesh:"meshes",camera:"cameras",light:"lights",node:"nodes",scene:"scenes"},r={buffers:"buffer",shaders:"shader",techniques:"technique",materials:"material",meshes:"mesh",cameras:"camera",lights:"light",nodes:"node",scenes:"scene"},i=Object.create(Object.prototype,{MESH:{value:"mesh"},MATERIAL:{value:"material"},TECHNIQUE:{value:"technique"},SHADER:{value:"shader"},SCENE:{value:"scene"},NODE:{value:"node"},CAMERA:{value:"camera"},VERTEX_ATTRIBUTES:{value:"vertexAttributes"},TYPE:{value:"type"},BUFFER:{value:"buffer"},_rootDescription:{value:null,writable:!0},rootDescription:{set:function(e){this._rootDescription=e},get:function(){return this._rootDescription}},baseURL:{value:null,writable:!0},_isAbsolutePath:{value:function(e){var t=new RegExp("^"+window.location.protocol,"i");return e.match(t)?!0:!1}},resolvePathIfNeeded:{value:function(e){if(this._isAbsolutePath(e))return e;var t=e.split("/"),n=t.pop();return this.baseURL+n}},_resolvePathsForCategories:{value:function(e){e.forEach(function(e){var t=this.json[e];if(t){var n=Object.keys(t);n.forEach(function(e){var n=t[e];n.path=this.resolvePathIfNeeded(n.path)},this)}},this)}},_json:{value:null,writable:!0},json:{enumerable:!0,get:function(){return this._json},set:function(e){this._json!==e&&(this._json=e,this._resolvePathsForCategories(["buffers","shaders"]))}},_path:{value:null,writable:!0},getEntryDescription:{value:function(e,t){var r=null,i=null,s=n[t];return i=this.rootDescription[s],i?i?i[e]:null:(console.log("ERROR:CANNOT find expected category named:"+s),null)}},_stepToNextCategory:{value:function(){this._state.categoryIndex=this.getNextCategoryIndex(this._state.categoryIndex+1);if(this._state.categoryIndex!==-1){var e=t[this._state.categoryIndex];return this._state.categoryState.index=0,!0}return!1}},_stepToNextDescription:{enumerable:!1,value:function(){var e=t[this._state.categoryIndex],n=this._state.categoryState,r=n.keys;return r?(n.index++,n.keys=null,n.index>=r.length?this._stepToNextCategory():!1):(console.log("INCONSISTENCY ERROR"),!1)}},hasCategory:{value:function(e){return this.rootDescription[e]?!0:!1}},_handleState:{value:function(){var e={buffer:this.handleBuffer,shader:this.handleShader,technique:this.handleTechnique,material:this.handleMaterial,mesh:this.handleMesh,camera:this.handleCamera,light:this.handleLight,node:this.handleNode,scene:this.handleScene},n=!0,i=this;while(this._state.categoryIndex!==-1){var s=t[this._state.categoryIndex],o=this._state.categoryState,u=o.keys;u||(o.keys=u=Object.keys(this.rootDescription[s]));var a=r[s],f=u[o.index],l=this.getEntryDescription(f,a);if(!l){if(this.handleError){this.handleError("INCONSISTENCY ERROR: no description found for entry "+f),n=!1;break}}else{if(e[a]&&e[a].call(this,f,l,this._state.userInfo)===!1){n=!1;break}this._stepToNextDescription()}}this.handleLoadCompleted&&this.handleLoadCompleted(n)}},_loadJSONIfNeeded:{enumerable:!0,value:function(e){var t=this;if(!this._json){var n,r=document.createElement("a");r.href=window.location.href;var i="";r.port&&(i+=":"+r.port),n=r.protocol+"//"+r.hostname+i;if(r.pathname.charAt(r.pathname.length-1)!=="/"){var s=r.pathname.split("/");s.pop(),n+=s.join("/")+"/"}else n+=r.pathname;if(!this._isAbsolutePath(this._path)){var o=this._path.split("/");o.length>1&&(o.pop(),n+=o.join("/")+"/")}this.baseURL=n;var u=new XMLHttpRequest;u.open("GET",this._path,!0),u.onreadystatechange=function(){u.readyState==4&&u.status==200&&(t.json=JSON.parse(u.responseText),e&&e(t.json))},u.send(null)}else e&&e(this.json)}},_buildLoader:{value:function(e){function n(n){t.rootDescription=n,e&&e(this)}var t=this;this._loadJSONIfNeeded(n)}},_state:{value:null,writable:!0},_getEntryType:{value:function(e){var n=t;for(var r=0;r<n.length;r++){var i=this.rootDescription[n[r]];if(i)return n[r]}return null}},getNextCategoryIndex:{value:function(e){for(var n=e;n<t.length;n++)if(this.hasCategory(t[n]))return n;return-1}},load:{enumerable:!0,value:function(e,t){var n=this;this._buildLoader(function(i){var s=n.getNextCategoryIndex.call(n,0);s!==-1&&(n._state={userInfo:e,options:t,categoryIndex:s,categoryState:{index:"0"}},n._handleState())})}},initWithPath:{value:function(e){return this._path=e,this._json=null,this}},initWithJSON:{value:function(e,t){return this.json=e,this.baseURL=t,t||console.log("WARNING: no base URL passed to Reader:initWithJSON"),this}}});return e&&(e.WebGLTFLoader=i),i})